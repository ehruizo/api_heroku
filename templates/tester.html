<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tester</title>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
    <script src="/static/js/jquery-3.3.1.min.js"></script>
</head>
<body>
    <div>
        <label for="sepal_length">Sepal length:</label>
        <input type="number" id="sepal_length" name="sepal_length" min="0.1" max="10" step=".1" />
        <label for="sepal_width">Sepal width:</label>
        <input type="number" id="sepal_width" name="sepal_width" min="0.1" max="10" step=".1" />
        <label for="petal_length">Petal length:</label>
        <input type="number" id="petal_length" name="petal_length" min="0.1" max="10" step=".1" />
        <label for="petal_width">Petal width:</label>
        <input type="number" id="petal_width" name="petal_width" min="0.1" max="10" step=".1" />
        <input type="submit" value="Pronosticar!!" onclick="getForecast()" />
    </div>
    <br />
    <div>
        <strong>Pron√≥stico:</strong>
        <br />
        <div id="records"></div>
        <br />
        <strong>JSON:</strong>
        <br />
        <pre><code id="json"></code></pre>
    </div>
    <script>
        function getForecast() {
            var sepal_length = document.getElementById('sepal_length').value;
            var sepal_width = document.getElementById('sepal_width').value;
            var petal_length = document.getElementById('petal_length').value;
            var petal_width = document.getElementById('petal_width').value;
            $.ajax({
                url: '{{ url_for('iris', _external=True) }}',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({'sepal_length': sepal_length,
                                      'sepal_width': sepal_width,
                                      'petal_length': petal_length,
                                      'petal_width': petal_width}),
                success: function (data) {
                    $('#json').html(JSON.stringify(data, null, 2));
                    buildTable(data);
                }
		    });
        }
        function buildTable(data) {
            var tabDiv = document.getElementById('records');
            tabDiv.innerHTML = '';
            if (data.predicted) {
                var _table = document.createElement('table');
                _table.className = 'table table-striped table-bordered';
                var _tableHead = _table.createTHead();
                var _tr = _tableHead.insertRow();
                ['Predicted', 'Probability'].forEach(function (elm) {
                    var _th = document.createElement('th');
                    _th.innerHTML = elm;
                    _tr.appendChild(_th);
                });
                var _tableBody = document.createElement('tbody');
                var _tr = document.createElement('tr');
                ['predicted', 'probability'].forEach(function (elm) {
                    var _td = document.createElement('td');
                    _td.innerHTML = data[elm];
                    _tr.appendChild(_td);
                });
                _tableBody.appendChild(_tr);
                _table.appendChild(_tableBody);
                tabDiv.appendChild(_table);
            }
        }
    </script>
</body>
</html>
